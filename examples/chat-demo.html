<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SDKWork Chat Demo</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #f5f5f5;
      height: 100vh;
      display: flex;
    }

    /* Sidebar */
    .sidebar {
      width: 260px;
      background: #fff;
      border-right: 1px solid #e0e0e0;
      display: flex;
      flex-direction: column;
    }

    .sidebar-header {
      padding: 16px;
      border-bottom: 1px solid #e0e0e0;
    }

    .new-chat-btn {
      width: 100%;
      padding: 12px;
      background: #10a37f;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 14px;
      font-weight: 500;
    }

    .new-chat-btn:hover {
      background: #0d8c6d;
    }

    .session-list {
      flex: 1;
      overflow-y: auto;
      padding: 8px;
    }

    .session-item {
      padding: 12px;
      margin-bottom: 4px;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 14px;
      color: #333;
    }

    .session-item:hover {
      background: #f0f0f0;
    }

    .session-item.active {
      background: #e6f4f1;
      color: #10a37f;
    }

    /* Main Chat Area */
    .main {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .chat-header {
      padding: 16px 24px;
      background: #fff;
      border-bottom: 1px solid #e0e0e0;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .chat-title {
      font-size: 16px;
      font-weight: 500;
      color: #333;
    }

    .chat-actions {
      display: flex;
      gap: 8px;
    }

    .icon-btn {
      width: 32px;
      height: 32px;
      border: none;
      background: transparent;
      cursor: pointer;
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .icon-btn:hover {
      background: #f0f0f0;
    }

    /* Messages */
    .messages {
      flex: 1;
      overflow-y: auto;
      padding: 24px;
    }

    .message {
      display: flex;
      gap: 16px;
      margin-bottom: 24px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }

    .message.user {
      flex-direction: row-reverse;
    }

    .avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      font-weight: 500;
      flex-shrink: 0;
    }

    .message.assistant .avatar {
      background: #10a37f;
      color: white;
    }

    .message.user .avatar {
      background: #5436da;
      color: white;
    }

    .message-content {
      flex: 1;
      padding: 12px 16px;
      border-radius: 12px;
      font-size: 14px;
      line-height: 1.6;
    }

    .message.assistant .message-content {
      background: #fff;
      border: 1px solid #e0e0e0;
    }

    .message.user .message-content {
      background: #5436da;
      color: white;
    }

    .message.streaming .message-content::after {
      content: '‚ñä';
      animation: blink 1s infinite;
      margin-left: 4px;
    }

    @keyframes blink {
      0%, 50% { opacity: 1; }
      51%, 100% { opacity: 0; }
    }

    /* Thinking Section */
    .thinking {
      margin-top: 12px;
      padding: 12px;
      background: #f9f9f9;
      border-radius: 8px;
      font-size: 13px;
      color: #666;
    }

    .thinking-label {
      font-weight: 500;
      margin-bottom: 8px;
      color: #333;
    }

    /* Tool Calls */
    .tool-calls {
      margin-top: 12px;
    }

    .tool-call {
      padding: 12px;
      background: #f0f7ff;
      border-radius: 8px;
      margin-bottom: 8px;
      font-size: 13px;
    }

    .tool-call-name {
      font-weight: 500;
      color: #0066cc;
      margin-bottom: 4px;
    }

    /* Input Area */
    .input-area {
      padding: 24px;
      background: #fff;
      border-top: 1px solid #e0e0e0;
    }

    .input-container {
      max-width: 800px;
      margin: 0 auto;
      position: relative;
    }

    .input-field {
      width: 100%;
      padding: 16px 48px 16px 16px;
      border: 1px solid #e0e0e0;
      border-radius: 12px;
      font-size: 14px;
      resize: none;
      outline: none;
      min-height: 56px;
      max-height: 200px;
    }

    .input-field:focus {
      border-color: #10a37f;
    }

    .send-btn {
      position: absolute;
      right: 12px;
      bottom: 12px;
      width: 32px;
      height: 32px;
      background: #10a37f;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .send-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .input-actions {
      display: flex;
      gap: 8px;
      margin-top: 8px;
      justify-content: center;
    }

    .action-btn {
      padding: 6px 12px;
      border: 1px solid #e0e0e0;
      background: #fff;
      border-radius: 6px;
      font-size: 12px;
      color: #666;
      cursor: pointer;
    }

    .action-btn:hover {
      background: #f5f5f5;
    }

    /* Status */
    .status-bar {
      position: fixed;
      bottom: 0;
      left: 260px;
      right: 0;
      padding: 8px 24px;
      background: #fff;
      border-top: 1px solid #e0e0e0;
      font-size: 12px;
      color: #666;
      display: flex;
      justify-content: space-between;
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    .status-dot.connected {
      background: #10a37f;
    }

    .status-dot.disconnected {
      background: #dc3545;
    }

    .status-dot.connecting {
      background: #ffc107;
      animation: pulse 1.5s infinite;
    }

    @keyframes pulse {
      0% { opacity: 1; }
      50% { opacity: 0.5; }
      100% { opacity: 1; }
    }
  </style>
</head>
<body>
  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <button class="new-chat-btn" onclick="createNewSession()">+ Êñ∞Âª∫ÂØπËØù</button>
    </div>
    <div class="session-list" id="sessionList">
      <!-- Sessions will be added here -->
    </div>
  </aside>

  <!-- Main Chat Area -->
  <main class="main">
    <header class="chat-header">
      <h1 class="chat-title">SDKWork Chat Demo</h1>
      <div class="chat-actions">
        <button class="icon-btn" title="Ê∏ÖÁ©∫ÂØπËØù" onclick="clearCurrentSession()">üóëÔ∏è</button>
        <button class="icon-btn" title="ËÆæÁΩÆ" onclick="openSettings()">‚öôÔ∏è</button>
      </div>
    </header>

    <div class="messages" id="messages">
      <!-- Messages will be added here -->
    </div>

    <div class="input-area">
      <div class="input-container">
        <textarea 
          class="input-field" 
          id="inputField"
          placeholder="ËæìÂÖ•Ê∂àÊÅØ..."
          rows="1"
          onkeydown="handleKeyDown(event)"
          oninput="autoResize(this)"
        ></textarea>
        <button class="send-btn" id="sendBtn" onclick="sendMessage()">‚û§</button>
      </div>
      <div class="input-actions">
        <button class="action-btn" onclick="toggleStream()">ÊµÅÂºèËæìÂá∫: <span id="streamStatus">ÂºÄ</span></button>
        <button class="action-btn" onclick="toggleThinking()">ÊòæÁ§∫ÊÄùËÄÉ: <span id="thinkingStatus">ÂºÄ</span></button>
      </div>
    </div>

    <div class="status-bar">
      <div class="status-indicator">
        <span class="status-dot connected" id="statusDot"></span>
        <span id="statusText">Â∑≤ËøûÊé•</span>
      </div>
      <div id="tokenCount">Token: 0</div>
    </div>
  </main>

  <script type="module">
    // Demo implementation
    // In real usage, import from the SDK:
    // import { SDKWorkAgent, ChatService, UIAdapter } from 'sdkwork-browser-agent';

    // Mock implementation for demo
    class MockSDKWorkAgent {
      async init() {
        console.log('Agent initialized');
      }

      async execute(input, context) {
        // Simulate processing
        await new Promise(resolve => setTimeout(resolve, 1000));
        return {
          success: true,
          output: 'ËøôÊòØÊ®°ÊãüÁöÑÂìçÂ∫î„ÄÇÂú®ÂÆûÈôÖÂ∫îÁî®‰∏≠ÔºåËøôÈáå‰ºöËøîÂõû Agent ÁöÑÊâßË°åÁªìÊûú„ÄÇ',
          executionId: 'exec-' + Date.now(),
          duration: 1000,
        };
      }

      async *executeStream(input, context) {
        const responses = [
          { content: 'ËøôÊòØ' },
          { content: 'Ê®°ÊãüÁöÑ' },
          { content: 'ÊµÅÂºè' },
          { content: 'ÂìçÂ∫î„ÄÇ' },
          { content: 'Âú®ÂÆûÈôÖ' },
          { content: 'Â∫îÁî®‰∏≠Ôºå' },
          { content: 'ËøôÈáå‰ºö' },
          { content: 'ËøîÂõû Agent' },
          { content: 'ÁöÑÊâßË°åÁªìÊûú„ÄÇ' },
        ];

        for (const chunk of responses) {
          await new Promise(resolve => setTimeout(resolve, 200));
          yield chunk;
        }
      }
    }

    // State
    let isStreamEnabled = true;
    let isThinkingEnabled = true;
    let currentSessionId = null;
    let sessions = [];
    let messages = [];

    // Initialize
    async function init() {
      // Create initial session
      createNewSession();
      
      // Add welcome message
      addMessage({
        role: 'assistant',
        content: '‰Ω†Â•ΩÔºÅÊàëÊòØ SDKWork Chat Demo„ÄÇ\n\nËøô‰∏™ÊºîÁ§∫Â±ïÁ§∫‰∫ÜÂàÜÂ±ÇÊû∂ÊûÑÁöÑËÅäÂ§©ÁïåÈù¢Ôºö\n- **Interface Layer**: UIAdapter\n- **Service Layer**: ChatService\n- **Agent Layer**: SDKWorkAgent\n\nÊîØÊåÅÁöÑÂäüËÉΩÔºö\n‚úÖ Chat Completion Ê†áÂáÜÊé•Âè£\n‚úÖ ÊµÅÂºèÂíåÈùûÊµÅÂºèËæìÂá∫\n‚úÖ ÂÆûÊó∂ÁïåÈù¢Êõ¥Êñ∞\n‚úÖ ‰ºöËØùÁÆ°ÁêÜ\n‚úÖ Â∑•ÂÖ∑Ë∞ÉÁî®ÊòæÁ§∫\n‚úÖ ÊÄùËÄÉËøáÁ®ãÂ±ïÁ§∫',
        status: 'complete'
      });
    }

    // Create new session
    function createNewSession() {
      const sessionId = 'session-' + Date.now();
      const session = {
        id: sessionId,
        name: `ÂØπËØù ${sessions.length + 1}`,
        createdAt: new Date(),
      };
      
      sessions.push(session);
      currentSessionId = sessionId;
      messages = [];
      
      renderSessions();
      renderMessages();
    }

    // Render sessions
    function renderSessions() {
      const container = document.getElementById('sessionList');
      container.innerHTML = sessions.map(session => `
        <div class="session-item ${session.id === currentSessionId ? 'active' : ''}" 
             onclick="switchSession('${session.id}')">
          üí¨ ${session.name}
        </div>
      `).join('');
    }

    // Switch session
    function switchSession(sessionId) {
      currentSessionId = sessionId;
      messages = []; // In real app, load from storage
      renderSessions();
      renderMessages();
    }

    // Clear current session
    function clearCurrentSession() {
      messages = [];
      renderMessages();
    }

    // Add message
    function addMessage(message) {
      message.id = 'msg-' + Date.now();
      message.timestamp = new Date();
      messages.push(message);
      renderMessages();
      scrollToBottom();
    }

    // Update message
    function updateMessage(id, updates) {
      const message = messages.find(m => m.id === id);
      if (message) {
        Object.assign(message, updates);
        renderMessages();
      }
    }

    // Render messages
    function renderMessages() {
      const container = document.getElementById('messages');
      container.innerHTML = messages.map(msg => `
        <div class="message ${msg.role} ${msg.status === 'streaming' ? 'streaming' : ''}" data-id="${msg.id}">
          <div class="avatar">${msg.role === 'user' ? 'U' : 'AI'}</div>
          <div class="message-content">
            ${formatContent(msg.content)}
            ${msg.thinking && isThinkingEnabled ? `
              <div class="thinking">
                <div class="thinking-label">üí≠ ÊÄùËÄÉËøáÁ®ã</div>
                ${msg.thinking}
              </div>
            ` : ''}
            ${msg.toolCalls && msg.toolCalls.length > 0 ? `
              <div class="tool-calls">
                ${msg.toolCalls.map(tool => `
                  <div class="tool-call">
                    <div class="tool-call-name">üîß ${tool.function.name}</div>
                    <div>${tool.function.arguments}</div>
                  </div>
                `).join('')}
              </div>
            ` : ''}
          </div>
        </div>
      `).join('');
    }

    // Format content
    function formatContent(content) {
      // Simple markdown-like formatting
      return content
        .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
        .replace(/\n/g, '<br>');
    }

    // Send message
    async function sendMessage() {
      const input = document.getElementById('inputField');
      const content = input.value.trim();
      
      if (!content) return;
      
      // Add user message
      addMessage({
        role: 'user',
        content: content,
        status: 'complete'
      });
      
      // Clear input
      input.value = '';
      autoResize(input);
      
      // Disable send button
      document.getElementById('sendBtn').disabled = true;
      
      if (isStreamEnabled) {
        await sendStreamMessage();
      } else {
        await sendNonStreamMessage();
      }
      
      // Enable send button
      document.getElementById('sendBtn').disabled = false;
    }

    // Send non-stream message
    async function sendNonStreamMessage() {
      const agent = new MockSDKWorkAgent();
      
      addMessage({
        role: 'assistant',
        content: 'ÊÄùËÄÉ‰∏≠...',
        status: 'pending'
      });
      
      const result = await agent.execute('test');
      
      // Update last message
      const lastMsg = messages[messages.length - 1];
      updateMessage(lastMsg.id, {
        content: result.output,
        status: 'complete'
      });
    }

    // Send stream message
    async function sendStreamMessage() {
      const agent = new MockSDKWorkAgent();
      
      const messageId = 'msg-' + Date.now();
      addMessage({
        id: messageId,
        role: 'assistant',
        content: '',
        status: 'streaming'
      });
      
      let content = '';
      
      for await (const chunk of agent.executeStream('test')) {
        content += chunk.content;
        updateMessage(messageId, {
          content: content,
          status: 'streaming'
        });
      }
      
      updateMessage(messageId, {
        status: 'complete'
      });
    }

    // Handle key down
    function handleKeyDown(event) {
      if (event.key === 'Enter' && !event.shiftKey) {
        event.preventDefault();
        sendMessage();
      }
    }

    // Auto resize textarea
    function autoResize(textarea) {
      textarea.style.height = 'auto';
      textarea.style.height = Math.min(textarea.scrollHeight, 200) + 'px';
    }

    // Scroll to bottom
    function scrollToBottom() {
      const messages = document.getElementById('messages');
      messages.scrollTop = messages.scrollHeight;
    }

    // Toggle stream
    function toggleStream() {
      isStreamEnabled = !isStreamEnabled;
      document.getElementById('streamStatus').textContent = isStreamEnabled ? 'ÂºÄ' : 'ÂÖ≥';
    }

    // Toggle thinking
    function toggleThinking() {
      isThinkingEnabled = !isThinkingEnabled;
      document.getElementById('thinkingStatus').textContent = isThinkingEnabled ? 'ÂºÄ' : 'ÂÖ≥';
      renderMessages();
    }

    // Open settings
    function openSettings() {
      alert('ËÆæÁΩÆÂäüËÉΩÂú®ÂÆåÊï¥ÁâàÊú¨‰∏≠ÂèØÁî®');
    }

    // Initialize
    init();

    // Expose functions to global scope for HTML onclick handlers
    window.createNewSession = createNewSession;
    window.switchSession = switchSession;
    window.clearCurrentSession = clearCurrentSession;
    window.sendMessage = sendMessage;
    window.handleKeyDown = handleKeyDown;
    window.autoResize = autoResize;
    window.toggleStream = toggleStream;
    window.toggleThinking = toggleThinking;
    window.openSettings = openSettings;
  </script>
</body>
</html>
